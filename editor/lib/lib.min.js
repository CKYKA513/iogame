const COLOR_CODES={wall:[0,0,0,255],spawn:[200,0,0],type1:[150,150,50],type2:[0,100,200],type3:[50,150,0]};setTimeout((()=>{let e=Object.values(COLOR_CODES),t=Object.keys(COLOR_CODES);for(let s=0;s<e.length;s++){document.getElementById(t[s]+"button").style="background-color: rgb("+e[s].join()+")"}}),1);class Grid{constructor(e,t,s,l,i,n){this.x=e,this.y=t,this.w=s,this.h=l,this.nbx=i,this.nby=n,this.values=[],this.t=0,this.clickedCount=0,this.drawType="wall",this.delete=!1}setDrawType(e){this.drawType=e}addBlock(e,t,s="wall"){let l=0;for(let s=0;s<this.values.length;s++)this.values[s].x===e&&this.values[s].y===t&&l++;0===l?(this.values.push({x:e,y:t,type:s}),console.log(this.values[this.values.length-1])):console.log("block present at "+e+","+t)}deleteBlock(e,t){let s=0;for(let l=0;l<this.values.length;l++)this.values[l].x===e&&this.values[l].y===t&&s++;if(0!==s){let s=this.values.findIndex((s=>s.x===e&&s.y===t));this.values.splice(s,1)}}toggleDelete(){this.delete=!this.delete,document.getElementById("deletebutton").textContent="Erase: "+this.delete}render(e){for(let e=0;e<this.nbx;e++)for(let t=0;t<this.nby;t++){let s="wall",l=this.values.find((l=>(s=l.type,l.x===e&&l.y===t)));mouseX>e*this.w+this.x&&mouseX<(e+1)*this.w+this.x&&mouseY>t*this.h+this.y&&mouseY<(t+1)*this.h+this.y?(mouseIsPressed&&0===this.clickedCount&&(this.delete?this.deleteBlock(e,t):this.addBlock(e,t,this.drawType),this.clickedCount++),fill(0,100)):l?fill.apply(null,COLOR_CODES[s]):noFill(),rect(e*this.w+this.x,t*this.h+this.y,this.w,this.h)}e>=this.t+1&&(this.t=this.t+1,this.clickedCount=0)}save(e="map"){var t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify({blocks:this.values})),s=document.createElement("a");s.setAttribute("href",t),s.setAttribute("download",e+".json"),document.body.appendChild(s),s.click(),s.remove()}}setTimeout((()=>{let e=document.getElementById("loadMap");e.addEventListener("change",(function(){var t=e.files[0];if(t.name.match(/\.(json)$/)){var s=new FileReader;s.onload=function(){console.log(s.result),grid.values=JSON.parse(s.result).blocks},s.readAsText(t)}else alert("File not supported, .json files only")}))}),1);let grid,wnx=800,wny=600;function setup(){createCanvas(wnx,wny).parent("editor"),frameRate(60),grid=new Grid(0,0,25,25,32,24)}let tick=0;function draw(){background(200),grid.render(tick),tick++}